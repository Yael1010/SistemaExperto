{% extends "base.html" %}
{% block content %}
<h3>3) Clasificar nuevos ejemplos</h3>
<form method="post" enctype="multipart/form-data" class="card p-3">
  <div class="mb-3">
    <label class="form-label">Modelo</label>
    <select class="form-select" name="model" required>
      {% for m in models %}
        <option value="{{ m }}">{{ m }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label class="form-label">Modo</label>
    <select class="form-select" name="mode" id="mode" onchange="toggleMode()">
      <option value="single">Single (formulario)</option>
      <option value="batch">Batch (CSV)</option>
    </select>
  </div>

  <div id="singleDiv">
    {% if features %}
      <div class="row g-2">
      {% for col in features %}
        <div class="col-md-4">
          <label class="form-label">{{ col }}</label>
          <input class="form-control" name="col__{{ col }}" placeholder="{{ col }}">
        </div>
      {% endfor %}
      </div>
      <button class="btn btn-success mt-3">Predecir (single)</button>
    {% else %}
      <p class="text-muted">Entrena un modelo para generar este formulario autom√°ticamente.</p>
    {% endif %}
  </div>

  <div id="batchDiv" style="display:none;">
    <p>Sube un CSV con las mismas columnas de entrenamiento (sin la columna target).</p>
    <input class="form-control" type="file" name="file" accept=".csv">
    <button class="btn btn-success mt-3">Predecir (batch)</button>
  </div>
</form>

{% if single_html %}
  <div class="card mt-4">
    <div class="card-header">Resultado (single)</div>
    <div class="card-body table-responsive">{{ single_html|safe }}</div>
  </div>
{% endif %}

{% if batch_file %}
  <div class="card mt-4">
    <div class="card-header">Resultado (batch)</div>
    <div class="card-body">
      <a class="btn btn-outline-primary" href="{{ url_for('download', folder='uploads', name=batch_file) }}">{{ batch_file }}</a>
      <div class="table-responsive mt-3">{{ batch_preview|safe }}</div>
    </div>
  </div>
{% endif %}

<script>
function toggleMode(){
  const v = document.getElementById('mode').value;
  document.getElementById('singleDiv').style.display = (v==='single') ? 'block' : 'none';
  document.getElementById('batchDiv').style.display  = (v==='batch') ? 'block' : 'none';
}
</script>
{% endblock %}
